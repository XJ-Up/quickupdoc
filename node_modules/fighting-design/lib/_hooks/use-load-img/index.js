"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var a=require("vue"),b=require("../../_utils/utils/index.js"),I=require("../use-run/index.js");const M=(s,t,d)=>{const{run:v}=I.useRun(),u=a.ref(!0),f=a.ref(!1);let w=!1;const h=(e,n,r)=>{e.src=r,u.value=!0,f.value=!0,v(t.onLoad,n)},L=e=>{u.value=!1,v(t.onError,e)},i=(e,n)=>{const r=new Image;new Promise((o,l)=>{r.src=n||t.src,r.addEventListener("load",c=>{o(c)}),r.addEventListener("error",c=>{l(c)})}).then(o=>{o&&h(e,o,r.src)}).catch(o=>{if(!w&&t.errSrc){i(e,t.errSrc),w=!0;return}L(o)})},E=e=>{const n=new IntersectionObserver(r=>{r[0].isIntersecting&&(i(e),n.unobserve(e))},{rootMargin:b.sizeChange(t.rootMargin)});return n},S=e=>{const n=()=>{const r=window.innerHeight||document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop,l=e.offsetParent.offsetTop,c=r+o-l;Math.abs(c)<Math.abs(b.sizeToNum(t.rootMargin))&&(i(e),window&&window.removeEventListener("scroll",n))};window&&window.addEventListener("scroll",n)},m=()=>{if(s.value){if(t.lazy){IntersectionObserver?E(s.value).observe(s.value):S(s.value);return}i(s.value)}},g=()=>{if(d){if(d())m();else return;return}m()};return a.onMounted(()=>{g()}),a.watch(()=>t.src,()=>{g()}),{isSuccess:u,isShowNode:f}};exports.useLoadImg=M;
